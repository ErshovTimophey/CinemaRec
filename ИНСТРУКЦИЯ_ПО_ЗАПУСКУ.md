# Инструкция по запуску проекта CinemaRec

## Вариант 1: Запуск через Docker Compose (Рекомендуется)

Этот вариант запускает все сервисы в Docker контейнерах.

### Требования:
- Docker Desktop установлен и запущен
- Docker Compose установлен
- Java JDK 17+ установлен (для сборки JAR файлов)
- Maven установлен (или используется mvnw из проекта)

### Шаги:

1. **Откройте терминал в корневой директории проекта**

2. **Перейдите в папку backend:**
   ```bash
   cd backend
   ```

3. **Запустите автоматическую сборку и запуск (РЕКОМЕНДУЕТСЯ):**
   
   **Windows (CMD):**
   ```cmd
   docker-compose-up.bat
   ```
   
   Этот скрипт автоматически:
   - Соберёт все JAR файлы для всех сервисов
   - Запустит Docker Compose с пересборкой образов
   - Запустит все сервисы в фоновом режиме
   
   **Альтернативный способ (вручную):**
   ```bash
   # Сначала соберите все JAR файлы
   build-all-jars.bat
   
   # Затем запустите Docker Compose
   docker-compose up --build -d
   ```
   
   **Для просмотра логов в реальном времени:**
   ```bash
   docker-compose up --build
   ```

4. **Дождитесь запуска всех сервисов** (это может занять несколько минут при первом запуске)

5. **Откройте браузер и перейдите по адресу:**
   - Frontend: http://localhost:3000
   - Auth Service: http://localhost:8081
   - User Service: http://localhost:8082
   - Recommendation Service: http://localhost:8083
   - Review Service: http://localhost:8085
   - Image Storage Service: http://localhost:8086
   - Quiz Service: http://localhost:8087
   - Statistics Service: http://localhost:8088

### Остановка сервисов:
```bash
docker-compose down
```

### Просмотр логов:
```bash
docker-compose logs -f [service-name]
# Например: docker-compose logs -f statistics-service
```

---

## Вариант 2: Локальный запуск (для разработки)

Этот вариант позволяет запускать сервисы локально без Docker.

### Требования:
- Java 17 или выше
- Maven 3.6+
- Node.js 16+ и npm
- PostgreSQL (если не используете Docker для БД)
- Redis (если не используете Docker для Redis)
- Kafka (если не используете Docker для Kafka)

### Запуск Backend сервисов:

#### 1. Запустите инфраструктуру (PostgreSQL, Redis, Kafka) через Docker:
```bash
cd backend
docker-compose up postgres redis kafka zookeeper -d
```

#### 2. Запустите каждый сервис отдельно:

**Auth Service (порт 8081):**
```bash
cd backend/auth-service
./mvnw spring-boot:run
```

**User Service (порт 8082):**
```bash
cd backend/user-service
./mvnw spring-boot:run
```

**Recommendation Service (порт 8083):**
```bash
cd backend/recommendation-service
./mvnw spring-boot:run
```

**Statistics Service (порт 8088):**
```bash
cd backend/statistics-service
./mvnw spring-boot:run
```

**Review Service (порт 8085):**
```bash
cd backend/review-service
./mvnw spring-boot:run
```

**Image Storage Service (порт 8086):**
```bash
cd backend/image-storage-service
./mvnw spring-boot:run
```

**Quiz Service (порт 8087):**
```bash
cd backend/quiz-service
./mvnw spring-boot:run
```

### Запуск Frontend:

1. **Перейдите в папку frontend:**
   ```bash
   cd frontend
   ```

2. **Установите зависимости (если еще не установлены):**
   ```bash
   npm install
   ```

3. **Запустите приложение:**
   ```bash
   npm start
   ```

4. **Откройте браузер:**
   - Frontend будет доступен по адресу: http://localhost:3000

---

## Проверка нового функционала просмотра фильмов

После запуска приложения:

1. **Войдите в систему** (зарегистрируйтесь или войдите, если уже есть аккаунт)

2. **Перейдите в раздел "Recommendations" или "Statistics"**

3. **Найдите карточку фильма** - на ней должна быть кнопка **"Смотреть"**

4. **Нажмите на кнопку "Смотреть"** - откроется страница просмотра с:
   - Информацией о фильме
   - Видеоплеером с трейлерами из YouTube
   - Списком доступных видео (если их несколько)

5. **Проверьте функциональность:**
   - Воспроизведение трейлеров
   - Переключение между разными видео
   - Отображение информации о фильме

---

## Устранение проблем

### Проблема: Сервисы не запускаются
- Убедитесь, что Docker Desktop запущен
- Проверьте, что порты не заняты другими приложениями
- Посмотрите логи: `docker-compose logs`

### Проблема: Frontend не подключается к backend
- Проверьте, что все backend сервисы запущены
- Убедитесь, что порты соответствуют настройкам в коде

### Проблема: Видео не загружаются
- Проверьте подключение к интернету (трейлеры загружаются с YouTube)
- Убедитесь, что TMDB API ключ валиден
- Проверьте логи statistics-service

### Проблема: Ошибка "JAVA_HOME is not set"
Если при запуске `docker-compose-up.bat` появляется ошибка о JAVA_HOME:

1. **Найдите путь к Java JDK:**
   ```cmd
   where java
   ```

2. **Установите JAVA_HOME:**
   ```cmd
   # Временно (для текущей сессии)
   set JAVA_HOME=C:\Program Files\Java\jdk-21
   
   # Или используйте готовый скрипт
   set-java-home.bat
   ```

3. **Проверьте установку:**
   ```cmd
   java -version
   echo %JAVA_HOME%
   ```

4. **Запустите сборку снова:**
   ```cmd
   docker-compose-up.bat
   ```

### Проблема: JAR файлы не собираются
- Убедитесь, что Java JDK 17+ установлен
- Проверьте, что Maven доступен (или используется mvnw из проекта)
- Попробуйте собрать вручную: `build-all-jars.bat`
- Проверьте логи сборки на наличие ошибок

---

## Порты сервисов

- **Frontend**: 3000
- **Auth Service**: 8081
- **User Service**: 8082
- **Recommendation Service**: 8083
- **Review Service**: 8085
- **Image Storage Service**: 8086
- **Quiz Service**: 8087
- **Statistics Service**: 8088
- **PostgreSQL**: 5434
- **Redis**: 6379
- **Kafka**: 9092, 29092
- **PgAdmin**: 5050

---

## Быстрый старт (Docker Compose)

### Windows (самый простой способ):

```cmd
# 1. Перейти в папку backend
cd backend

# 2. Запустить автоматическую сборку и запуск
docker-compose-up.bat

# 3. Открыть браузер
# http://localhost:3000
```

### Linux/Mac или ручной запуск:

```bash
# 1. Перейти в папку backend
cd backend

# 2. Собрать все JAR файлы (если нужно)
./build-all-jars.sh  # или вручную через Maven

# 3. Запустить все сервисы
docker-compose up --build -d

# 4. Открыть браузер
# http://localhost:3000
```

### Проверка статуса сервисов:

```bash
# Просмотр статуса всех контейнеров
docker-compose ps

# Просмотр логов конкретного сервиса
docker-compose logs -f statistics-service
docker-compose logs -f user-service
docker-compose logs -f frontend
```
